# golang.tokyo 6 (2017/06/01)

## Gopher Fest 2017
@tenntenn

### 概要
- サンフランシスコで開催されるGoSFが主催のイベント
- The state of Goのお話

### The state of Go
- Go1.9は5/1にコードフリーズ済み
  - 残りはバグフィックスのみ
- リファクタリングを安全にする方法
  - Codebase Refactoring by rsc
- Goで安全にリファクタできるのか?
  - 定数の場合は問題なし
  - 関数はラップして引き継げば問題なし
  - 型の場合
    - 型を作る → メソッドが引き継げない
    - 埋め込み → キャストができない
- Go1.9言語仕様変更
  - Alias を作成できる
    - 型のエイリアスを定義できる
    - `type A = http.Client`
    - 完全に同じ型
    - キャスト不要
    - エイリアスの方ではメソッドを定義できない
- 標準ライブラリ変更
  - math/bits ビット演算に便利なライブラリ
    - `tips`を頭につけると最新のdocが見れる
  - `syc.Map` スレッドセーフなマップ
  - `html.template`がより安全に利用可能に
    - errorを返却するようになる
  - os.Exec
    - 重複の際、一番後ろのものを優先する
- ランタイムの改善
  - だいたい早くなっている
- ツール類の変更
  - 行の末尾にセミコロンが入る(もとから)
- go testの改善
  - vendorを無視するようになった
- go docの改善
  - フィールドにリンクが貼れるようになった

### 感想
Go1.9にあたっての改善点のお話がメインとなりました。  
@tenntennさんもおっしゃってましたが、 `go test`で`vendor`配下を  
みなくなる修正はなかなか良いですね。


## 初めてGolangで大規模Microservicesを作り得た教訓
Yuichi Murata

### 概要
- いきなりつかってみたため、失敗談が中心
- 構成(blog参照)
  - GAE/Go
  - Gin/Echo
  - Microservices構成
- 結論
  - 困ったときはGoの哲学にそったシンプルなアプローチを取る
  - Goを過信せずパフォーマンスに気を配る

### 教訓
#### フレームワークにこだわらない
- ベストプラクティスを調査
  - フレームワークを利用した成功体験からフレームワーク探しから
  - 大事かと思いこだわって調査した
- Gin
  - 良い点
    - シンプル
    - App Engine とのインテグレーション有り
    - Framework Context vs App Engine Context
      - gin.ContextからAECに派生させられることで解消
  - 困った点
    - ワイルドカードパスを利用したルーティング
- Echo
  - 良かった点
    - ワイルドカードパス利用できる
    - コンポーネント開発が捗る
  - 困った点
    - 設計が書き換わる
- まとめ
  - Goでは、net/httpパッケージで十分
    - 足りない部分はライブラリを利用
  - フレームワークを利用しなくても統一的なコードとなる

#### Interfaceを尊重する
- 独自のエラー型を定義
  - こちらの型にerrorを寄せる
  - キャストが面倒のため
- Nilに型がある問題発生
  - 独自のエラー型を混在させた際に発生
    - 独自型とerrorインタフェースでnilの型が異なる
- まとめ
  - Interfaceが定義されたものはそのまま利用する

#### regex compile/ reflectionが遅い
- バリデーション
  - JSON Schemaを利用
- GolangでのJSON Schema
  - 2点ほど候補に上がった
- パフォーマンステストで問題発覚
  - バリデーションの有無でパフォーマンスに顕著な差が出る
  - `pprof`を利用して実行を解析
- 問題点の解消
  - Regexコンパイルをキャッシュ
  - reflectionを多用していた→利用しないように修正
- go-jsvalを利用すればさらに早くなった
- まとめ
  - regex/reflectionのコスト高を意識する
  - regex compile / reflectionはとにかく重い

#### 非対称暗号は遅い
- 認証・認可処理
  - 非対称鍵の処理が重い
    - opensslと比べcypto/rsaが貧弱
    - 一桁程度の差が生じる
    - cgoを利用したopensslのバインディングも存在
    - 非対称鍵の処理署名処理をPHPにして外出し(httpリクエストのほうが早い)

### 感想
GAE/Goでサービスを作る際の問題点がいくつか聞けてよかった。  
サービスでの利用はこれからあるかもなので、参考になりました。  


## ゲーム開発に欠かせないあれをしゅっとみる
ゴリラのアイコンの人

### 概要
- CSVの話
  - スマホゲームには欠かせない
- カヤックではデータの受け渡しとしてCSVを利用している
  - マスターデータ等
- CSV困る時
  - カラムとデータの関連性が見づらい
  - 空欄がつらい
  - DBにインポートする系はその際にわかる
  - 調査系で利用する時つらい
- github.com/Konboi/csviewer
  - csvをDBテーブルをみるように検索できる
- ライブラリ
  - sliceflag
    - 同一オプションで複数の値を受け取りたい
    - 普段のflagの利用方法と変わらない
  - tablewriter
    - データをいい感じに表示するのは大変
    - いい感じに表示してくれる


## Go Review Commentを翻訳した話
@knsh14

### 概要
- Go Code Review Commentを読もう
  - コードレビューをする際に見るべき箇所をまとめたもの
  - Effective Goの簡略版
- 翻訳してみました(qitta)
- 良かった点
  - 正解のパターンを勉強できるところが効率が良い
- 内容
  - コードの見た目を改善
    - ツールでなんとかしよう
    - golintは優秀
  - コメントや文章の体裁
  - Tips系
    - より良いパターンを記載
  - 設計の指針
- まとめ
  - 良いドキュメントの翻訳は英語の勉強に最適


## ScalaからGo
James

### 概要
- 関数型開発はGoでできるか?
  - できないですね
  - ジェネリクスがないので。。
- 関数型開発のコンセプトは利用できるか？
  - 利用できる!
- 関数型開発とは?
  - 副作用がない開発
  - 副作用あり
    - テストしにくい、バグの原因
  - 部分適用
- 初心者が入りやすく会社での導入がスムーズに


## Crypto in Go

### 概要
- Goにおける暗号アルゴリズムの利用
- AES
  - 固定長でしか利用できない
- AES + Padding + HMac
  - 行数があって面倒
- AES + GCM
  - 機密モード + 認証モードがひとつに
  - とってもシンプル
- Coucerea?