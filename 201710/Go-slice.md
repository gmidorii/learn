# Goのsliceって結局どう書けばいいの？

## 概要
色々な資料を見返しながら、sliceの実装を書いてる気がするので、
一旦自分で調べてまとめます。

## 現状理解

### Array
- 固定長配列
  - lenを変える事はできない
- 型に配列長も含まれる

### Slice
- 可変長配列
  - Arrayへの参照を持っている
- len
  - sliceの長さ
- cap
  - 確保したメモリの長さ
- 変更時
  - capを上回っている場合は、allocしてcapを確保してlen追加

## サンプル実装と測定
### Slice生成
#### 測定
宣言時に追加 `461.6 ns`
```go
  s := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}
```
```
0:   335 ns [0 1 2 3 4 5 6 7 8 9]
0:   479 ns [0 1 2 3 4 5 6 7 8 9]
0:   571 ns [0 1 2 3 4 5 6 7 8 9]
```

len=0で初期化 `9532 ns`
```go
	s := make([]int, 0)
	for i := 0; i < 10; i++ {
    // s[i] = i だとindexOutOfBounds
		s = append(s, i)
	}
```
```
1:  6750 ns [0 1 2 3 4 5 6 7 8 9]
1: 11202 ns [0 1 2 3 4 5 6 7 8 9]
1: 10644 ns [0 1 2 3 4 5 6 7 8 9]
```

len=10で初期化 `369.3 ns`
```go
	s := make([]int, 10)
	for i := 0; i < 5; i++ {
		s[i] = i
	}
```
```
4:   343 ns [0 1 2 3 4 5 6 7 8 9]
4:   402 ns [0 1 2 3 4 5 6 7 8 9]
4:   363 ns [0 1 2 3 4 5 6 7 8 9]
```

len=0,cap=10で初期化 `412 ns`
```go
	s := make([]int, 0, 10)
	for i := 0; i < 10; i++ {
		s = append(s, i)
	}
```
```
2:   452 ns [0 1 2 3 4 5 6 7 8 9]
2:   406 ns [0 1 2 3 4 5 6 7 8 9]
2:   378 ns [0 1 2 3 4 5 6 7 8 9]
```

len=10,cap=10で初期化 `416 ns`
```go
	s := make([]int, 10, 10)
	for i := 0; i < 5; i++ {
		s[i] = i
	}
	return
```
```
3:   432 ns [0 1 2 3 4 5 6 7 8 9]
3:   375 ns [0 1 2 3 4 5 6 7 8 9]
3:   441 ns [0 1 2 3 4 5 6 7 8 9]
```

#### 結果 (asc)
- len=10で初期化        `369.3 ns`
- len=0,cap=10で初期化  `412 ns`
- len=10,cap=10で初期化 `416 ns`
- 宣言時に追加           `461.6 ns`
- len=0で初期化         `9532 ns`

#### 考察



## 参考
- [Go のスライスの内部実装](http://jxck.hatenablog.com/entry/golang-slice-internals)
