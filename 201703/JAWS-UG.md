# JAWS-UG 2017/03/11


## [DeepDive] 新訳 とあるアーキテクトのクラウドデザインパターン目録 by JAWS-UGアーキテクチャ専門支部

### 概要
- 運用は大事
- 運用時の品質 = 製品の品質
- クラウドデザインパターン

### Route53 Hibrid Cloud
- オンプレとクラウド兼用
- オンプレから名前解決
    - public hosted zoneにprivate IPアドレス？
    - 結論としては非推奨

### AMI Maintenance Environment
- 定期的にAMIを取得しているか
- EC2にSSHログインをして構成変更すると再構築が難しい
- EC2の構築にSSHログインを利用せずに構築する
- user-data=EC2起動時に実行できるスクリプト

### Serverless
- 3層構造は移行はし易いがコストがかかる
- リザーブド/スポットインスタンスの利用
- マイクロサービスアーキテクチャ
    - サービス間は疎結合
    - サーバーに状態を持たない(ステートレス)
    - 各サービスの実装は比較的簡単 -> 単体テストが容易
    - 処理の自動化
- マネージドサービスへの置き換え
    - Lambda: 最大メモリ1.5GB,最大処理時間5分,3回リトライ
    - DynamoDB: スループット保証,KVS,トランザクションは自前で実装
    - CloudWatch: トランザクションidを使いまわす(X-Rayが解決してくれるかも)
- 動的Webサービス
    - Route53でドメイン管理
    - S3にファイルを配置して返す
    - cognitoで認証
        - ユーザー認証した人のみ処理
        - Twitterログインにも対応
- 2回目以降は静的ページ
    - S3にファイルをキャッシュ
    - CloudFrontにはキャッシュを持たせない
    - 404なら30Xを返して別処理を行う
- ポーリング
    - 遅延はSQSで実装
    - BeanstalkのWorkerを利用する
    - WorkerでLambdaを叩く
    - t2.nanoで問題ない 
    - Step Functionでいけるのでは？
        - 状態遷移回数で課金
        - そこまでお安くはない(1000人->$162)


## AWS SECURITY DEATH \m/ ～セキュ鮫様からのお告げ～ by Security-JAWS

### ネットワーク
- Amazon VPC
- Public subnet -> インターネットに公開
    - EIPとのヒモ付も可能
- Private subnet
    - 内側 -> 外側の接続は可能
- ステートフル
    - 80/Anyとすると戻りも開けてくれる
    - セキュリティグループ
- ステートレス
    - 行きと戻りを開ける
    - subnet単位でセキュリティ制御
- VPN
    - プライベートネットワーク接続を行う
    - 接続時にルーティングを行う
- Direct Connect
    - 接続ポイントまではキャリアに依頼する必要あり

### DDos対策
- DDos
    - L3/L4, L7
    - DDosをあえて受ける
- AWS Shild
    - CloudFrontにてShildオプションを有効化
    - Shildの後ろは、クラウド・オンプレを問わない
    - 常に監視してベースラインを作成
    - DDosのアクセス分は無料
    - WAFのチューニングやルール作成
    - CloudFrontがあれば入れておくのが良さげ
- AWS WAF
    - 通信の遮断対応
    - CloudFront,ELB等で有効化する
    - IP制限や簡単なSQLインジェクションが制限可
    - 検知ログが100件しかとれない
    - POSTはログとして見れない

### AWS Config
- 概要
    - 構成管理のためのサービス
    - 変更履歴
    - AWSリソース間で関係性を見ることができる
- SystemsManager
    - EC2の中にエージェントをいれると様々な動作が見れる
    - update情報をConfigで見れる
- 一覧でAWSリソースをみれる
- 削除されたサービスも見れる
- 関連リソースをたどることができるのでエラーの原因にたどり着きやすくなる
- AWS Config rules
    - AWS Configで設定した値が正しいのかを判定
    - マネージドルール : あるあるなものはほぼ提供されている
    - カスタムルール : Lambda実行
        - AWSがカスタムルールを提供している

## サーバレスの今と未来

### 概要
- サーバーレス: サーバ-について考えなくても良くなる
- アーキテクチャを要考慮
- 他のAWSサービスの基盤としてLambdaが使われている
    - ポータービリィティが必要なところにどんどん取り入れられていくのでは
- ビジネスアプリを作っていく際の知見を公開する
- Serverless Framework
    - Node
    - 開発フレームワーク
    - 資金調達してマネタイズを行う流れ
    - 安心して利用できそう
- AWS Serverless Application Model(SAM)
    - サーバーレスアプリをCFnテンプレートで管理できる
    - app-spec.yaml
    - S3を介してLambdaにデプロイされる
- サーバーレスでできること
    - 得意ではない部分を外部に任せられる
- サーバーレスの注意
    - 自分の利用しているサービスが外部サービスのどの部分に関わっているのか
    - どういう技術か認識しておく
    - *サービスはあなたの支払うお金で成り立っている*
- Lambdaの同時実行数: 100
- Lambdaの活用
    - システムをリアクティブに
    - やっていく気持ち
- Serverless開発手法(SPA)
    - JSを書くことが大部分を占める
    - テスト駆動でアプリコードを追加する
    - 必ず始める前にテストを用意しておく
    - 個人だとローカルで十分
    - チーム開発がはじまったらS3に入れる
    - ブラウザキャッシュで詰まる
    - AWSをつなぐまでは、ひたすらテストコードを書く
    - DynamoDBに対して直接リクエストをする場合は仕様として危険がある
    - Lambdaを噛ませてバリデーションをする
- Serverless Single Page App (本)
    - 日本語訳が完了している模様
- ServerlessConf



## [DeepDive] おとなのたしなみ、おコンテナ by JAWS-UGコンテナ支部

### 概要
- コンテナの中だけでプロセスが動いているわけではない
    - HostOS上で、 `ps aux` するとみれる
    - ネームスペース等を利用して見えないようにしているだけ
- Dockerを使う理由
    - ポータビリティ
        - ただ本番に検証と同様のDockerfileを置くには少々考慮が必要
        - git,gccとかは本番にはいらない
    - トレーサビリティ
    - イメージ共有の簡便性
    - 高速なデリバリーサイクルへの親和性が高い
- コンテナで挫折する理由
    - `フィットしない..`
    - ベスト・プラクティスにそっていない開発手法のため
- Twelve-factor app
- コンテナに適した下記を考える
    - チーム体制
    - デリバリー
    - 運用
    - インフラ構築
- コンテナ時代のチーム体制
    - deployを数分数時間でできるようにする
    - そのために定期的にリリースする
    - 安心して戻せるところまで含めて自動化
- コンテナ時代のデリバリーモデル
    - CI結果をRegistryに保存 -> 保存先が統一される
    - 実行定義
        - 環境変数
        - マウントするディレクトリ
        - ポート
        - コンテナの中で走らせる実行コマンド
    - イメージ + 実行定義 => スケールアウト可能
    - ユーザー →　マネージャー →　エージェント →　Dockerエンジン
- コンテナ時代のインフラモデル
    - instanceが増えるわけではない
    - クラスター: 複数のホストを一つのリソースとみなす
    - どこでも動かせる=いつでも復旧できる
    - CPU予約率
    - CPU予約率が高まるとinstanceを増やす
- コンテナ時代のアプリケーション
    - ホストマシンに期待をしない
    - 起動処理が遅い
        - db migrate → それは他の部分でやる(実行定義の部分？)
- コンテナ時代の運用
    - シェルを書いて頑張るのではない
    - 下記を分割して考える
        - 実行時に決定する部分
        - 環境変数で書く部分
    - sshしたら、、sedしたら、、
- 3/30 コンテナ支部


## [DeepDive] APIを叩くだけでない、Deep Learning on AWS で自分だけの学習モデルを作ろう！ by JAWS-UG AI支部

### Deeplearningのクラウドアーキテクチャ
- やりたいことはAPIをただ叩くだけでは実現できない
- フレームワークが無料で使える
- Learningはスパコンのアーキテクチャ
    - バッチ処理
    - 数日間マシンを回し続ける
- HPC(スパコン)アーキテクチャ
    - GPUが必須
    - マルチノード環境(MPI)
    - GPU(CUDA)
    - 学習終了時間は読めない
- 学習期間中のみinstanceを起動
- HPC環境を楽に
    - cfncluster
- プリ処理
    - 学習データセットの作成
    - BIGDATEを作成(オープンなデータセット)
    - 仕掛け作りでデータを作る
- デプロイ環境
    - 学習済みモデルをサービス側に渡す部分
- 全体をみてデザインをする必要がある
- APIでシステムを操作できることが重要
- フレームワークを適切に使う
- AMIを使う
- SaaSタイプのサービスを使う