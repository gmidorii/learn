# Go で関数に渡したポインタの値を変更するには

## TL;DR

https://play.golang.org/p/q6hv6IlUBsu

```go
package main

func change(s *string) {
  *s = "changed"
}

func main() {
  s := "hoge"
  change(&s)
  fmt.Println(s)
}
```

## 解説

Go ではポインタを扱えることができますが、 `&` や `*` をどうつけたらいいか、よくわからなくなってしまいがちです。
まずは一旦整理してみます。

### 構文

整理すると、2 種類の構文があるのではないかと思います。

#### 演算子として利用される場合

- `&` は値型変数からポインタ(メモリのアドレス)型変数を取得する演算子
- `*` はポインタ型変数から値型変数を取得する演算子

```go
var tmp string = "tmp"

// ポインタ
tmpPointer := &hoge
// 値
tmpValue := *tmpPointer

fmt.Println(tmpPointer) // 0x40c128
fmt.Println(tmpValue)   // tmp
```

#### 型として利用される場合

`*` は任意の型のポインタ型

```go
// ポインタ型
type stringPointer *string
```

### 回答

ここでは関数にポインタ型を渡して、ポインタが指す値を変更したいと考えています。
状況的には、以下のような形です。

```go
func change(s *string) {
  // 値を変換する。
}
```

`補足`
そもそも、なぜポインタ型を渡す必要があるかですが、値型の場合は関数内での変更が関数外へ伝搬しないためです。
つまり、関数内で引数の値をいくら変更しても、関数の呼び出し元には一切影響しません。
これは、Go の引数の受け渡し方が値渡し (値をコピーして関数に渡す方法) に由来します。

実際の変更コードですが、以下になります。

```go
func change(s *string) {
  *s = "changed"
}
```

まず、関数の引数の `s` ですが、ポインタ型になっています。Go の関数は値渡しで引数をわたすので、
`s` はポインタ型変数のコピーになっています。ですが、ポインタ型の変数の中身(アドレス)がコピーされただけなので、
ポインタが指す先の値はおなじになっています。
つまり、関数内でポインタが指す先の値を変更することで、値を変更することができます。

実際の値取得ですが、変数 `s` はポインタ型のため、 `*` 演算子をつけることで取得できます。
取得した値に "changed" という新しい文字列を代入しているので、値を変更することができました。

## 所感

とても基礎的なところですが、よくこんがらがるのでまとめてみました。
参考になりましたら、嬉しいです。

## 参考

- [A Tour of Go](https://tour.golang.org/moretypes/1)
- [Go のポインタ - はじめての Go 言語](http://cuto.unirita.co.jp/gostudy/post/pointer/)
- [Go で学ぶポインタとアドレス - Qiita](https://qiita.com/Sekky0905/items/447efa04a95e3fec217f)
